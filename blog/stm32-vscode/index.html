<!doctype html><html lang=en-us data-theme><head><meta charset=utf-8><meta name=HandheldFriendly content="True"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer-when-downgrade"><title>STM32 environment on Visual Studio Code - Bonnee's space</title>
<meta name=description content="A personal blog for projects and thoughts"><link rel=icon href="https://github.com/Bonnee.png?size=64"><link rel=apple-touch-icon-precomposed href="https://github.com/Bonnee.png?size=64"><link rel=stylesheet href=https://www.bonnee.me/css/style.min.930c6fce9dcdde89718c3a768aad3dd95f661c258583e3b1b8ed1d833e833486.css integrity="sha256-kwxvzp3N3olxjDp2iq092V9mHCWFg+OxuO0dgz6DNIY="><meta property="og:title" content="STM32 environment on Visual Studio Code"><meta property="og:description" content="Originally published on GitHub Gists
This page will help you setup Visual Studio Code for programming and debugging STM32 boards using STM32CubeMX projects.
I tested this guide under Arch Linux and Ubuntu 18.04. If you get it to work under other setups please let me know so that I can update the steps with more info.
Warning If you were using STM32CubeIDE or SystemWorkbench before, you need to convert your projects in order for them to work."><meta property="og:type" content="article"><meta property="og:url" content="https://www.bonnee.me/blog/stm32-vscode/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2019-11-02T00:00:00+00:00"><meta property="article:modified_time" content="2019-11-02T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="STM32 environment on Visual Studio Code"><meta name=twitter:description content="Originally published on GitHub Gists
This page will help you setup Visual Studio Code for programming and debugging STM32 boards using STM32CubeMX projects.
I tested this guide under Arch Linux and Ubuntu 18.04. If you get it to work under other setups please let me know so that I can update the steps with more info.
Warning If you were using STM32CubeIDE or SystemWorkbench before, you need to convert your projects in order for them to work."></head><body><a class=skip-main href=#main>Skip to main content</a><div class=container><header class=common-header><h1 class=site-title><a href=/>Bonnee's space</a></h1><nav><a href=https://www.bonnee.me/about title>about</a>
<a href=https://www.bonnee.me/projects title>projects</a>
<a href=https://www.bonnee.me/blog title>blog</a>
<a href=https://gallery.bonnee.me title>gallery</a>
<a href=https://t.me/bonnys_space title>μblog</a>
<a href=https://www.bonnee.me/index.xml title>rss</a></nav></header><main id=main tabindex=-1><article class=post><header class=post-header><h1 class=post-title>STM32 environment on Visual Studio Code</h1></header><div class=post-info><div class=post-date>2019-11-02</div><div class=post-taxonomies><ul class=post-categories><li><a href=https://www.bonnee.me/categories/>blog</a></li></ul><ul class=post-tags><li><a href=https://www.bonnee.me/tags/dev>#dev</a></li><li><a href=https://www.bonnee.me/tags/micro>#micro</a></li><li><a href=https://www.bonnee.me/tags/stm32>#stm32</a></li></ul></div></div><div class=content><blockquote><p>Originally published on <a href=https://gist.github.com/Bonnee/393c4be25d2e8620d9ec406073940d3a>GitHub Gists</a></p></blockquote><p>This page will help you setup Visual Studio Code for programming and debugging STM32 boards using STM32CubeMX projects.</p><p>I tested this guide under Arch Linux and Ubuntu 18.04. If you get it to work under other setups please let me know so that I can update the steps with more info.</p><h2 id=warning>Warning</h2><p>If you were using STM32CubeIDE or SystemWorkbench before, you need to convert your projects in order for them to work. The conversion procedure is fully reversible.
Up until the time of writing this guide, it is not possible to use STM32CubeIDE and Visual Studio Code on the same project unless some configuration changes are made on CubeIDE.
Besides that, it is recommended that every person that works on a project runs the same working environment.</p><h1 id=installation>Installation</h1><h2 id=steps>Steps</h2><ol><li><a href=#1-stm32cubemx>STM32CubeMX</a></li><li><a href=#2-gnu-arm-embedded-toolchain>GNU ARM Embedded Toolchain</a></li><li><a href=#3-make>Make</a></li><li><a href=#4-openocd>OpenOCD</a></li><li><a href=#5-visual-studio-code>Visual Studio Code</a><ol><li><a href=#51-cc-extension>C/C++ Extension</a></li><li><a href=#52-stm32-for-vscode-extension>stm32-for-vscode Extension</a></li></ol></li></ol><h2 id=1-stm32cubemx>1. STM32CubeMX</h2><p>If you already have CubeMX installed, you can skip this step.</p><h4 id=arch-linux>Arch Linux</h4><p>Install <code>stm32cubemx</code> from the <a href=https://wiki.archlinux.org/index.php/Arch_User_Repository>AUR</a>. If you don&rsquo;t have access to the AUR or you just don&rsquo;t want to use it, follow the step below.</p><h4 id=inferior-operating-systems-windows-ubuntu-temple-os>Inferior operating systems (Windows, Ubuntu, Temple OS&mldr;)</h4><p>Download the .zip from <a href=https://www.st.com/en/development-tools/stm32cubemx.html>here</a> (you have to sign up to ST&rsquo;s website) and install the right version for your OS.</p><hr><h2 id=2-gnu-arm-embedded-toolchain>2. GNU ARM Embedded Toolchain</h2><p>These are the tools needed to compile and debug the code.</p><h3 id=arch-linux-1>Arch Linux</h3><p>Install <code>arm-none-eabi-gcc</code> <code>arm-none-eabi-gdb</code> <code>arm-none-eabi-newlib</code>.</p><h3 id=debianubuntu>Debian/Ubuntu</h3><p>Install <code>gcc-arm-none-eabi</code> <code>gdb-multiarch</code> <code>libnewlib-arm-none-eabi</code>.</p><h3 id=windows>Windows</h3><p>Install the toolchain from <a href=https://developer.arm.com/tools-and-software/open-source-software/developer-tools/gnu-toolchain/gnu-rm/downloads>ARM&rsquo;s website</a>.</p><hr><h2 id=3-make>3. Make</h2><h3 id=linux>Linux</h3><p>Install <code>make</code> from your package manager.</p><h3 id=windows-1>Windows</h3><p>Install make from this <a href=http://gnuwin32.sourceforge.net/packages/make.htm>this</a> page (updated in 2006 though&mldr;).
It should be possible to get the current version of make through <a href=https://en.wikipedia.org/wiki/Windows_Subsystem_for_Linux>WSL</a>, but I don&rsquo;t have experience with it.</p><hr><h2 id=4-openocd>4. OpenOCD</h2><p>Open On-Chip Debugger is the interface between your computer and the programmer. It will take care of uploading the compiled software to the STM32 and during debug it will open the connection between the computer and the STM32.</p><h3 id=linux-1>Linux</h3><p>Install <code>openocd</code> from your package manager.</p><p><strong>Warning</strong>: for some newer microcontrollers and programmers you might need to build OpenOCD from sources, especially if your distro doesn&rsquo;t ship the latest version.</p><h3 id=windows-2>Windows</h3><p>I received feedback about <a href=https://xpack.github.io/openocd/install/>xPack OpenOCD</a> working fine with this setup.</p><hr><h2 id=5-visual-studio-code>5. Visual Studio Code</h2><p>The next steps aren&rsquo;t really necessary to get the thing working. You could just use a shell and your favorite editor and you would have (almost) all the functionality of the complete setup. Visual Studio Code is just a pretty front-end.</p><h3 id=linux-2>Linux</h3><p><a href=https://code.visualstudio.com/docs/setup/linux>The official linux page</a> contains the instructions to install the latest version of VSCode on many distributions.</p><h3 id=windows-3>Windows</h3><p>Download and install the program from the <a href=https://code.visualstudio.com/>official website</a>.</p><hr><h3 id=51-cc-extension>5.1. C/C++ Extension</h3><p>This extension will take care of intellisense, syntax highlighting and more.
Install <a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode.cpptools">this</a> extension in Visual Studio Code.</p><h3 id=52-stm32-for-vscode-extension>5.2. stm32-for-vscode Extension</h3><p>Same as above, but with <a href="https://marketplace.visualstudio.com/items?itemName=bmd.stm32-for-vscode">this</a> extension.</p><h1 id=configuration>Configuration</h1><h2 id=1-stm32cubemx-1>1. STM32CubeMX</h2><p>By default CubeMX generates projects in a format called EWARM. Unfortunately, EWARM is currently not supported by the VSCode extension, but the more generic Makefile structure is. In order to configure CubeMX to support VSCode you have to navigate to <code>Project Manager->Project->Toolchain/IDE</code> and set it to Makefile.</p><p>If you don&rsquo;t want your STM32Cube library path being spammed all over the makefile (if you need to share the project with someone else for example) you can tell CubeMX to copy the necessary files to the project&rsquo;s directory and link the makefile to them. The option is located in <code>Project Manger->Code Generator->STM32Cube MCU packages and embedded software packs</code>.</p><p>After CubeMX setup you can click on <code>GENERATE CODE</code>; the new Makefile project structure should get created.</p><hr><h2 id=2-visual-studio>2. Visual Studio</h2><p>Using the <code>Open folder</code> menu in Visual Studio Code, navigate to your project&rsquo;s root folder and open it.
Now open the command palette (<code>Ctrl+Shift+P</code> or <code>F1</code>) and run <code>Build clean STM32 project</code>. A terminal should appear and you will see gcc (hopefully) building your project.</p><hr><h1 id=usage>Usage</h1><h2 id=compiling--flashing>Compiling & Flashing</h2><p>After you call <code>Build STM32 Project</code> for the first time, stm32-for-vscode will create two custom tasks (that can be accessed by typing <code>Ctrl+Shift+B</code>) to build your code and to flash it into the STM32 board.</p><h2 id=debugging>Debugging</h2><p>To debug the code just press <code>F5</code> inside VSCode and the debugger will start automatically. Remember to stop the debugger before flashing new code.</p><h1 id=troubleshooting>Troubleshooting</h1><h3 id=error-libusb_open-failed-with-libusb_error_access-during-upload><code>Error: libusb_open() failed with LIBUSB_ERROR_ACCESS</code> during upload</h3><p>This happnes because you don&rsquo;t have permission to open the serial device. In order to fix this you need to add your user to the group that owns the serial interface. To get the serial interface name you can run <code>dmesg | grep tty</code> after plugging the STM32 in. Read the last line, you should see something like:</p><pre tabindex=0><code>cdc_acm 2-2:1.2: ttyACM0: USB ACM device
</code></pre><p>In this example <code>ttyACM0</code> is the device name.
Now that you know the name you can get the owner by doing <code>ls -l /dev/ttyACM0</code>. The output looks like this:</p><pre tabindex=0><code>crw-rw----  1 user   group   4, 166 set 11 08:45 /dev/ttyACM0
</code></pre><p><code>group</code> indicates the group name.</p><p>Now you just need to add your user to the group by doing <code>sudo usermod -aG group $USER</code>, substituting <code>group</code> with the group name you have discovered above.</p><p>You are done. Log out of your account and log back in to apply the change.</p></div></article></main><footer class=common-footer><div class=common-footer-bottom><div class=copyright><p>© 2024 Matteo Bonora</p></div><nav><a href=mailto:bonora.matteo@gmail.com title>email</a>
<a href=https://t.me/Bonny title>telegram</a>
<a href=https://github.com/Bonnee title>github</a>
<a href=https://gitlab.com/bonnee title>gitlab</a>
<a href=https://www.linkedin.com/in/matteo-bonora-748a6b1a8/ title>linkedin</a></nav></div></footer></div></body></html>