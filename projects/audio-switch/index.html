<!doctype html><html lang=en-us data-theme><head><meta charset=utf-8><meta name=HandheldFriendly content="True"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer-when-downgrade"><title>Two channel audio source switch with Wi-Fi - Bonnee's space</title>
<meta name=description content="A personal blog for projects and thoughts"><link rel=icon href="https://github.com/Bonnee.png?size=64"><link rel=apple-touch-icon-precomposed href="https://github.com/Bonnee.png?size=64"><link rel=stylesheet href=https://www.bonnee.me/css/style.min.930c6fce9dcdde89718c3a768aad3dd95f661c258583e3b1b8ed1d833e833486.css integrity="sha256-kwxvzp3N3olxjDp2iq092V9mHCWFg+OxuO0dgz6DNIY="><meta property="og:title" content="Two channel audio source switch with Wi-Fi"><meta property="og:description" content="The HiFi system in my livingroom is centered around an amplifier from the &rsquo;80s. There are a few audio sources connected to it:
A television A Chromecast Audio A record player The amplifier is powered through a smart plug that, through the power of Home Assistant, turns on whenever there is an active audio source and gets shut when there is none. Although nice and very convenient, this is not enough from keeping the listener from fiddling with the amplifier&rsquo;s switches to choose the right audio source, since it gets toggled quite often between the TV and the Chromecast."><meta property="og:type" content="article"><meta property="og:url" content="https://www.bonnee.me/projects/audio-switch/"><meta property="og:image" content="https://www.bonnee.me/projects/audio-switch/complete.jpg"><meta property="article:section" content="projects"><meta property="article:published_time" content="2020-11-29T09:50:13+01:00"><meta property="article:modified_time" content="2020-11-29T09:50:13+01:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.bonnee.me/projects/audio-switch/complete.jpg"><meta name=twitter:title content="Two channel audio source switch with Wi-Fi"><meta name=twitter:description content="The HiFi system in my livingroom is centered around an amplifier from the &rsquo;80s. There are a few audio sources connected to it:
A television A Chromecast Audio A record player The amplifier is powered through a smart plug that, through the power of Home Assistant, turns on whenever there is an active audio source and gets shut when there is none. Although nice and very convenient, this is not enough from keeping the listener from fiddling with the amplifier&rsquo;s switches to choose the right audio source, since it gets toggled quite often between the TV and the Chromecast."></head><body><a class=skip-main href=#main>Skip to main content</a><div class=container><header class=common-header><h1 class=site-title><a href=/>Bonnee's space</a></h1><nav><a href=https://www.bonnee.me/about title>about</a>
<a href=https://www.bonnee.me/projects title>projects</a>
<a href=https://www.bonnee.me/blog title>blog</a>
<a href=https://gallery.bonnee.me title>gallery</a>
<a href=https://t.me/bonnys_space title>μblog</a>
<a href=https://www.bonnee.me/index.xml title>rss</a></nav></header><main id=main tabindex=-1><article class=post><header class=post-header><h1 class=post-title>Two channel audio source switch with Wi-Fi</h1></header><div class=post-info><div class=post-date>2020-11-29</div><div class=post-taxonomies><ul class=post-categories><li><a href=https://www.bonnee.me/categories/>projects</a></li></ul><ul class=post-tags><li><a href=https://www.bonnee.me/tags/home-automation>#home-automation</a></li><li><a href=https://www.bonnee.me/tags/hifi>#hifi</a></li><li><a href=https://www.bonnee.me/tags/micro>#micro</a></li><li><a href=https://www.bonnee.me/tags/esp>#esp</a></li></ul></div></div><div class=content><p>The HiFi system in my livingroom is centered around an amplifier from the &rsquo;80s. There are a few audio sources connected to it:</p><ol><li>A television</li><li>A Chromecast Audio</li><li>A record player</li></ol><p>The amplifier is powered through a smart plug that, through the power of <a href=https://www.home-assistant.io/>Home Assistant</a>, turns on whenever there is an active audio source and gets shut when there is none. Although nice and very convenient, this is not enough from keeping the listener from fiddling with the amplifier&rsquo;s switches to choose the right audio source, since it gets toggled quite often between the TV and the Chromecast.</p><p>The ideal solution would be to automate the switch on the amplifier, but this requires some ugly mechanics around the switch, or an invasive internal modification. A simpler way to go is the use of a relay to phisically switch audio source when needed.
To simplify the solution I decided to exclude the record player from the problem, since it is rarely used and it needs the listener to set the right volume on the amplifier anyway.</p><p>Surprisingly enough, I didn&rsquo;t find any commercial audio switcher that meets my needs. There are plenty of audio switchers on Amazon, but none of them is controllable remotely. However, there are a few DIY solutions out there. At the end I decided to make my own, basing my solution on <a href=https://www.hackster.io/govindanunni07/wifi-controlled-audio-source-selector-switch-wi-casss-d40ed3>Wi-CASSS</a>, a design made by <a href=https://www.hackster.io/govindanunni>Govindan Unni</a>.</p><p>I chose to go with a relay-based design because it&rsquo;s simple to make and gives the best audio insulation.</p><h2 id=bom>BOM</h2><h3 id=main-circuit>Main circuit</h3><table><thead><tr><th>Item</th><th>Qty</th></tr></thead><tbody><tr><td>ESP8266 ESP-01s</td><td>1</td></tr><tr><td>OMRON G6S-2 (5V) signal relay</td><td>1</td></tr><tr><td>Panel 3.5 mm Stereo jacks</td><td>3</td></tr><tr><td>1N4007 diode</td><td>1</td></tr><tr><td>Micro USB breakout board</td><td>1</td></tr><tr><td>5V to 3.3V AMS1117 breakout board</td><td>1</td></tr><tr><td>BC547 transistor</td><td>1</td></tr><tr><td>1 kΩ resistor</td><td>1</td></tr><tr><td>220 Ω resistor</td><td>2</td></tr><tr><td>5mm round LED</td><td>2</td></tr><tr><td>10µf capacitor</td><td>1</td></tr><tr><td>100µf capacitor</td><td>1</td></tr></tbody></table><h3 id=front-panel>Front panel</h3><table><thead><tr><th>Item</th><th>Qty</th></tr></thead><tbody><tr><td>5mm round LED</td><td>2</td></tr><tr><td>Momentary push button</td><td>1</td></tr></tbody></table><p>After some shopping on AliExpress, the total cost amounted to almost 14 euros shipped (excluding LEDs and reistors which I already have) including many spare components, enough to make at least two complete circuits.</p><h2 id=schematics>Schematics</h2><p><figure><img src=original-schematic.jpg alt="Original schematic."><figcaption><p>Original schematic.</p></figcaption></figure>I redesigned the relay driver circuit to include status LEDs for each input and also simplified it a bit. <a href=https://bit.ly/wifiaudioswitch>Here</a> is a circuitjs link for the relay driver schematic. The ESP8266 power circuit has been maintained identical to Wi-CASSS&rsquo;s schematic.<figure><a href=https://bit.ly/wifiaudioswitch><img src=relay-driver.jpg alt="Redesigned relay driver circuit."></a><figcaption><p>Redesigned relay driver circuit.</p></figcaption></figure></p><p>I realized the circuit on perfboard since it&rsquo;s quick and easy to make circuits out of.
In the following picture you can see and early attempt at placing the components. This first try still used the original Wi-CASSS&rsquo;s schematic (as you can see by the extra diode in the top left corner of the picture).<figure><img src=drawing.jpg alt="Early components placement prototype."><figcaption><p>Early components placement prototype.</p></figcaption></figure></p><h2 id=enclosure>Enclosure</h2><p>I decided to design and 3D print my own enclosure. I didn&rsquo;t want to have dangling wires coming out of it, so all external peripherals are detachable.</p><p>Power comes from a micro-usb breakout board, external connections to the front panels are handled by a small perfboard with pin headers. To hold all the connectors in place I designed the enclosure with supports and holes to handle that.<figure><img src=supports.jpg alt="Supports in CAD vs IRL."><figcaption><p>Supports in CAD vs IRL.</p></figcaption></figure><figure><img src=usb-mount.jpg alt="The micro-USB board is held in place with superglue and two copper pins (out of thick wire core)."><figcaption><p>The micro-USB board is held in place with superglue and two copper pins (out of thick wire core).</p></figcaption></figure></p><p>After drilling the board, it&rsquo;s ready to be fit into the case. The circuit is secured using 2 screws; It was supposed to be three but a few drilling errors prevented that. The board still feels firm anyway.
A late addition to the circuit is the power LED, which is soldered to the 3.3V line, with its current-limiting resistor on the wire, since it wasn&rsquo;t planned in my original design.<figure><img src=top-view.jpg alt="Top view of the open enclosure"><figcaption><p>It wont win any beauty contest, but it works.</p></figcaption></figure><figure><img src=enclosure-open.jpg alt="Front view of the box"><figcaption><p>The print quality is far from perfect, but this box will not be visible anyway.</p></figcaption></figure></p><p>The top cover is a thin sheet alluminium panel cut to dimension and screwed on top.</p><figure><img src=complete.jpg alt="Front view of the box"><figcaption><p>Here it is in all its uglyness.</p></figcaption></figure><h2 id=front-panel-1>Front Panel</h2><p><figure><img src=panel_cad.jpg alt="Front panel CAD."><figcaption><p>Front panel CAD.</p></figcaption></figure><figure><img src=panel.jpg alt="Front panel completed and mounted."><figcaption><p>Front panel completed and mounted.</p></figcaption></figure><figure><img src=button-bottom.jpg alt="The button"><figcaption><p>It&rsquo;s incredible how cheap these buttons are while still feeling pretty good.</p></figcaption></figure></p><p>The front panel is the local interface to the switch. It contains a momentary push-button to toggle input and two press-fitted LEDs that indicate the selected one.<br>The button I used came from a PC front panel power button. Searching online for &ldquo;pc power switch&rdquo; I found it is produced by many manufacturers and can be found for just a few cents.<figure><img src=panel-back_cad.jpg alt="Front panel&amp;rsquo;s back side. Here you can see the button retainer clip."><figcaption><p>Front panel&rsquo;s back side. Here you can see the button retainer clip.</p></figcaption></figure><figure><img src=panel-nocap.jpg alt="Front panel without the keycap."><figcaption><p>Front panel without the keycap.</p></figcaption></figure></p><p>I designed a keycap to go on the switch along with a mounting for the front panel. Since I am sort of a keyboard nerd, the black legend is actually 3D-printed by first printing the legend, which is just a single layer thick, then the filament is swapped while the bed is kept hot, and the rest of the cap is printed.</p><figure><img src=keycap.jpg alt="Back of the keycap with stem and it&amp;rsquo;s reinforcement. It&amp;rsquo;s a miniature keyboard keycap basically. So cute."><figcaption><p>Back of the keycap with stem and it&rsquo;s reinforcement. It&rsquo;s a miniature keyboard keycap basically. So cute.</p></figcaption></figure><h2 id=software>Software</h2><p>Instead of reinventing the wheel writing custom ESP8266 firmware, I just flashed <a href=https://tasmota.github.io/docs/>Tasmota</a> on the ESP-01 and linked it to <a href=https://www.home-assistant.io/>Home Assistant</a> through MQTT.
I then set up two simple automations to automatically toggle the inputs.</p><p><code>automations.yaml</code>:</p><pre tabindex=0><code>alias: Switch to Chromecast Audio
description: Switch audio source to Chromecast Audio
trigger:
  - entity_id: binary_sensor.chromecast_audio_status
    platform: state
    to: &#39;on&#39;
  - entity_id: binary_sensor.tv_status
    platform: state
    to: &#39;off&#39;
condition:
  - condition: state
    entity_id: binary_sensor.chromecast_audio_status
    state: &#39;on&#39;
  - condition: state    # Don&#39;t switch to Chromecast Audio if TV is on
    entity_id: binary_sensor.tv_status
    state: &#39;off&#39;
action:
  - service: switch.turn_on
    entity_id: switch.audio_switch
mode: single

alias: Switch to TV
description: Switch audio source to TV
trigger:
  - entity_id: binary_sensor.chromecast_audio_status
    platform: state
    to: &#39;off&#39;
  - entity_id: binary_sensor.tv_status
    platform: state
    to: &#39;on&#39;
condition:
  - condition: state
    entity_id: binary_sensor.tv_status
    state: &#39;on&#39;
action:
  - service: switch.turn_off
    entity_id: switch.audio_switch
  - service: media_player.turn_off # Turn off other speaker if TV is on
    entity_id: media_player.other_speaker
mode: single
</code></pre><h2 id=conclusions>Conclusions</h2><p>I&rsquo;ve been using the switch for a couple of weeks without a single issue. Audio quality has not changed and it is very convenient to not touch the amplifier anymore. I will see how long the relay contacts hold up, but for the time being it&rsquo;s working perfectly.</p><p><a href=https://github.com/Bonnee/wifi-audio-switch>Here&rsquo;s</a> the repository with all the 3D models, pictures and schematics.</p></div></article></main><footer class=common-footer><div class=common-footer-bottom><div class=copyright><p>© 2024 Matteo Bonora</p></div><nav><a href=mailto:bonora.matteo@gmail.com title>email</a>
<a href=https://t.me/Bonny title>telegram</a>
<a href=https://github.com/Bonnee title>github</a>
<a href=https://gitlab.com/bonnee title>gitlab</a>
<a href=https://www.linkedin.com/in/matteo-bonora-748a6b1a8/ title>linkedin</a></nav></div></footer></div></body></html>